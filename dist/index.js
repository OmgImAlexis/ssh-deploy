module.exports=function(e,t){"use strict";var n={};function __webpack_require__(t){if(n[t]){return n[t].exports}var r=n[t]={i:t,l:false,exports:{}};e[t].call(r.exports,r,r.exports,__webpack_require__);r.l=true;return r.exports}__webpack_require__.ab=__dirname+"/";function startup(){return __webpack_require__(555)}t(__webpack_require__);return startup()}({87:function(e){e.exports=require("os")},129:function(e){e.exports=require("child_process")},243:function(e,t,n){"use strict";var r=n(129).exec;var i=n(129).execSync;var s=n(747);var o=n(622);var u=s.access;var c=s.accessSync;var a=s.constants||s;var f=process.platform=="win32";var d=function(e,t){u(e,a.F_OK,function(e){t(!e)})};var l=function(e){try{c(e,a.F_OK);return false}catch(e){return true}};var p=function(e,t){u(e,a.F_OK|a.X_OK,function(e){t(null,!e)})};var v=function(e){try{c(e,a.F_OK|a.X_OK);return true}catch(e){return false}};var h=function(e,t,n){d(e,function(i){if(!i){var s=r("command -v "+t+" 2>/dev/null"+" && { echo >&1 "+t+"; exit 0; }",function(e,t,r){n(null,!!t)});return}p(e,n)})};var y=function(e,t,n){if(/[\x00-\x1f<>:"\|\?\*]/.test(e)){n(null,false);return}var i=r("where "+t,function(e){if(e!==null){n(null,false)}else{n(null,true)}})};var g=function(e,t){if(l(e)){try{var n=i("command -v "+t+" 2>/dev/null"+" && { echo >&1 "+t+"; exit 0; }");return!!n}catch(e){return false}}return v(e)};var m=function(e,t,n){if(/[\x00-\x1f<>:"\|\?\*]/.test(e)){return false}try{var r=i("where "+t,{stdio:[]});return!!r}catch(e){return false}};var _=function(e){if(/[^A-Za-z0-9_\/:=-]/.test(e)){e="'"+e.replace(/'/g,"'\\''")+"'";e=e.replace(/^(?:'')+/g,"").replace(/\\'''/g,"\\'")}return e};if(f){_=function(e){var t=/[\\]/.test(e);if(t){var n='"'+o.dirname(e)+'"';var r='"'+o.basename(e)+'"';return n+":"+r}return'"'+e+'"'}}e.exports=function commandExists(e,t){var n=_(e);if(!t&&typeof Promise!=="undefined"){return new Promise(function(t,n){commandExists(e,function(r,i){if(i){t(e)}else{n(r)}})})}if(f){y(e,n,t)}else{h(e,n,t)}};e.exports.sync=function(e){var t=_(e);if(f){return m(e,t)}else{return g(e,t)}}},250:function(e,t,n){"use strict";var r=n(129).spawn;var i=n(669);var s=function(e){if(typeof e==="string"){return e.replace(/\b\s/g,"\\ ")}else{return e}};var o=function(e){["src","dest","include","exclude","excludeFirst"].forEach(function(t){var n=e[t];if(typeof n==="string"){e[t]=s(n)}else if(Array.isArray(n)===true){e[t]=n.map(s)}});return e};e.exports=function(e,t){e=e||{};e=i._extend({},e);e=o(e);var n=e.platform||process.platform;var s=n==="win32";if(typeof e.src==="undefined"){throw new Error("'src' directory is missing from options")}if(typeof e.dest==="undefined"){throw new Error("'dest' directory is missing from options")}var u=e.dest;if(typeof e.host!=="undefined"){u=e.host+":"+e.dest}if(!Array.isArray(e.src)){e.src=[e.src]}var c=[].concat(e.src);c.push(u);var a=(e.args||[]).find(function(e){return e.match(/--chmod=/)});if(s&&!a){c.push("--chmod=ugo=rwX")}if(typeof e.host!=="undefined"||e.ssh){c.push("--rsh");var f="ssh";if(typeof e.port!=="undefined"){f+=" -p "+e.port}if(typeof e.privateKey!=="undefined"){f+=" -i "+e.privateKey}if(typeof e.sshCmdArgs!=="undefined"){f+=" "+e.sshCmdArgs.join(" ")}c.push(f)}if(e.recursive===true){c.push("--recursive")}if(e.times===true){c.push("--times")}if(e.syncDest===true||e.deleteAll===true){c.push("--delete");c.push("--delete-excluded")}if(e.syncDestIgnoreExcl===true||e.delete===true){c.push("--delete")}if(e.dryRun===true){c.push("--dry-run");c.push("--verbose")}if(typeof e.excludeFirst!=="undefined"&&i.isArray(e.excludeFirst)){e.excludeFirst.forEach(function(e,t){c.push("--exclude="+e)})}if(typeof e.include!=="undefined"&&i.isArray(e.include)){e.include.forEach(function(e,t){c.push("--include="+e)})}if(typeof e.exclude!=="undefined"&&i.isArray(e.exclude)){e.exclude.forEach(function(e,t){c.push("--exclude="+e)})}switch(e.compareMode){case"sizeOnly":c.push("--size-only");break;case"checksum":c.push("--checksum");break}if(typeof e.args!=="undefined"&&i.isArray(e.args)){c=[...new Set([...c,...e.args])]}c=[...new Set(c)];var d=function(){};var l=e.onStdout||d;var p=e.onStderr||d;var v="rsync ";c.forEach(function(e){if(e.substr(0,4)==="ssh "){e='"'+e+'"'}v+=e+" "});v=v.trim();if(e.noExec){t(null,null,null,v);return}try{var h="";var y="";var g;if(s){g=r("cmd.exe",["/s","/c",'"'+v+'"'],{windowsVerbatimArguments:true,stdio:[process.stdin,"pipe","pipe"]})}else{g=r("/bin/sh",["-c",v])}g.stdout.on("data",function(e){l(e);h+=e});g.stderr.on("data",function(e){p(e);y+=e});g.on("exit",function(e){var n=null;if(e!==0){n=new Error("rsync exited with code "+e);n.code=e}t(n,h,y,v)})}catch(e){t(e,null,null,v)}}},428:function(e,t,n){var r=n(129).exec;var i={get:getString,run:runCommand};function runCommand(e){return r(e)}function getString(e,t){return r(e,function(){return function(e,n,r){if(!t)return;t(e,n,r)}}(t))}e.exports=i},431:function(e,t,n){"use strict";var r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)if(Object.hasOwnProperty.call(e,n))t[n]=e[n];t["default"]=e;return t};Object.defineProperty(t,"__esModule",{value:true});const i=r(n(87));function issueCommand(e,t,n){const r=new Command(e,t,n);process.stdout.write(r.toString()+i.EOL)}t.issueCommand=issueCommand;function issue(e,t=""){issueCommand(e,{},t)}t.issue=issue;const s="::";class Command{constructor(e,t,n){if(!e){e="missing.command"}this.command=e;this.properties=t;this.message=n}toString(){let e=s+this.command;if(this.properties&&Object.keys(this.properties).length>0){e+=" ";let t=true;for(const n in this.properties){if(this.properties.hasOwnProperty(n)){const r=this.properties[n];if(r){if(t){t=false}else{e+=","}e+=`${n}=${escapeProperty(r)}`}}}}e+=`${s}${escapeData(this.message)}`;return e}}function toCommandValue(e){if(e===null||e===undefined){return""}else if(typeof e==="string"||e instanceof String){return e}return JSON.stringify(e)}t.toCommandValue=toCommandValue;function escapeData(e){return toCommandValue(e).replace(/%/g,"%25").replace(/\r/g,"%0D").replace(/\n/g,"%0A")}function escapeProperty(e){return toCommandValue(e).replace(/%/g,"%25").replace(/\r/g,"%0D").replace(/\n/g,"%0A").replace(/:/g,"%3A").replace(/,/g,"%2C")}},470:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){function adopt(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){i(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())})};var i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)if(Object.hasOwnProperty.call(e,n))t[n]=e[n];t["default"]=e;return t};Object.defineProperty(t,"__esModule",{value:true});const s=n(431);const o=i(n(87));const u=i(n(622));var c;(function(e){e[e["Success"]=0]="Success";e[e["Failure"]=1]="Failure"})(c=t.ExitCode||(t.ExitCode={}));function exportVariable(e,t){const n=s.toCommandValue(t);process.env[e]=n;s.issueCommand("set-env",{name:e},n)}t.exportVariable=exportVariable;function setSecret(e){s.issueCommand("add-mask",{},e)}t.setSecret=setSecret;function addPath(e){s.issueCommand("add-path",{},e);process.env["PATH"]=`${e}${u.delimiter}${process.env["PATH"]}`}t.addPath=addPath;function getInput(e,t){const n=process.env[`INPUT_${e.replace(/ /g,"_").toUpperCase()}`]||"";if(t&&t.required&&!n){throw new Error(`Input required and not supplied: ${e}`)}return n.trim()}t.getInput=getInput;function setOutput(e,t){s.issueCommand("set-output",{name:e},t)}t.setOutput=setOutput;function setCommandEcho(e){s.issue("echo",e?"on":"off")}t.setCommandEcho=setCommandEcho;function setFailed(e){process.exitCode=c.Failure;error(e)}t.setFailed=setFailed;function isDebug(){return process.env["RUNNER_DEBUG"]==="1"}t.isDebug=isDebug;function debug(e){s.issueCommand("debug",{},e)}t.debug=debug;function error(e){s.issue("error",e instanceof Error?e.toString():e)}t.error=error;function warning(e){s.issue("warning",e instanceof Error?e.toString():e)}t.warning=warning;function info(e){process.stdout.write(e+o.EOL)}t.info=info;function startGroup(e){s.issue("group",e)}t.startGroup=startGroup;function endGroup(){s.issue("endgroup")}t.endGroup=endGroup;function group(e,t){return r(this,void 0,void 0,function*(){startGroup(e);let n;try{n=yield t()}finally{endGroup()}return n})}t.group=group;function saveState(e,t){s.issueCommand("save-state",{name:e},t)}t.saveState=saveState;function getState(e){return process.env[`STATE_${e}`]||""}t.getState=getState},555:function(e,t,n){"use strict";n.r(t);var r=n(622);var i=n(470);const s=e=>{const t=Object.keys(e);const n=t.filter(t=>{const n=e[t];if(!n){Object(i.error)(`⚠️ [INPUTS] ${t} is mandatory.`)}return n});if(n.length!==t.length){Object(i.setFailed)(`⚠️ [INPUTS] Inputs not valid, aborting.`);process.exit()}};var o=n(669);var u=n(677);var c=n(428);var a=undefined&&undefined.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function fulfilled(e){try{step(r.next(e))}catch(e){s(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){s(e)}}function step(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())})};const f=Object(o.promisify)(c.get);const d=()=>a(undefined,void 0,void 0,function*(){const e=Object(u.sync)("rsync");if(!e){yield f("sudo apt-get --no-install-recommends install rsync").catch(e=>{Object(i.setFailed)(`⚠️ [CLI] Rsync installation failed. Aborting ...\n${e.message}`);process.exit()});Object(i.info)(`✅ [CLI] Rsync installed.`)}});var l=n(747);const{GITHUB_WORKSPACE:p}=process.env;const v=e=>{if(Object(l.existsSync)(e)){Object(i.info)(`[SSH] ${e} dir exists.`);return}Object(i.info)(`[SSH] Creating ${e} dir in ${p}`);Object(l.mkdirSync)(e);Object(i.info)("✅ [SSH] dir created.")};const h=e=>{if(Object(l.existsSync)(e)){Object(i.error)(`[SSH] ${e} file exists.`);return}Object(i.info)(`[SSH] Creating ${e} file in ${p}`);try{Object(l.writeFileSync)(e,"",{encoding:"utf8",mode:384});Object(i.info)("✅ [SSH] file created.")}catch(e){Object(i.error)("⚠️ [SSH] writeFileSync error\n${filePath}\n${error.message}");process.abort()}};const{HOME:y}=process.env;const g=(e,t)=>{const n=Object(r.join)(y||__dirname,".ssh");const s=Object(r.join)(n,t);v(n);h(`${n}/known_hosts`);try{Object(l.writeFileSync)(s,e,{encoding:"utf8",mode:384})}catch(e){Object(i.error)(`⚠️ writeFileSync error\n${s}\n${e.message}`);process.abort()}Object(i.info)(`✅ Ssh key added to \`.ssh\` dir ${s}`);return s};var m=n(250);var _=n.n(m);var O=undefined&&undefined.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function fulfilled(e){try{step(r.next(e))}catch(e){s(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){s(e)}}function step(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())})};const b=Object(o.promisify)(_.a);const S={ssh:true,sshCmdArgs:["-o StrictHostKeyChecking=no"],recursive:true};const x=({privateKey:e,port:t,src:n,dest:r,args:s})=>O(undefined,void 0,void 0,function*(){Object(i.info)(`[Rsync] Starting Rsync Action: ${n} to ${r}`);return b(Object.assign({src:n,dest:r,args:s,privateKey:e,port:t},S)).catch(e=>{Object(i.setFailed)(`⚠️ [Rsync] command error: \n${e.message}\n${e.stack}`);process.exit()})});var j=undefined&&undefined.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function fulfilled(e){try{step(r.next(e))}catch(e){s(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){s(e)}}function step(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())})};const{DEPLOY_KEY_NAME:w}=process.env;const E=({src:e,dest:t,args:n,host:r="localhost",port:i,username:s,privateKeyContent:o})=>j(undefined,void 0,void 0,function*(){const u=g(o,w||"deploy_key");const c=`${s}@${r}:${t}`;yield d();yield x({privateKey:u,port:i,src:e,dest:c,args:n})});var C=undefined&&undefined.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function fulfilled(e){try{step(r.next(e))}catch(e){s(e)}}function rejected(e){try{step(r["throw"](e))}catch(e){s(e)}}function step(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())})};const{REMOTE_HOST:P,REMOTE_USER:$,REMOTE_PORT:A,SSH_PRIVATE_KEY:R,SOURCE:T,TARGET:F,ARGS:H,GITHUB_WORKSPACE:K}=process.env;const I=()=>C(undefined,void 0,void 0,function*(){if(!K){Object(i.error)("⚠️ [general] GITHUB_WORKSPACE env is missing.");return}Object(i.info)(`[general] GITHUB_WORKSPACE: ${K}`);s({SSH_PRIVATE_KEY:R,REMOTE_HOST:P,REMOTE_USER:$});const e=T.startsWith("/")?T:Object(r.join)(K,T||"");const t=F||`/home/${$}/`;return E({src:e,dest:t,args:H?[H]:["-rltgoDzvO"],host:P,port:A||"22",username:$,privateKeyContent:R})});I().catch(e=>{Object(i.setFailed)(e.message)})},622:function(e){e.exports=require("path")},669:function(e){e.exports=require("util")},677:function(e,t,n){e.exports=n(243)},747:function(e){e.exports=require("fs")}},function(e){"use strict";!function(){e.r=function(e){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})}}();!function(){var t=Object.prototype.hasOwnProperty;e.d=function(e,n,r){if(!t.call(e,n)){Object.defineProperty(e,n,{enumerable:true,get:r})}}}();!function(){e.t=function(t,n){if(n&1)t=this(t);if(n&8)return t;if(n&4&&typeof t==="object"&&t&&t.__esModule)return t;var r=Object.create(null);e.r(r);Object.defineProperty(r,"default",{enumerable:true,value:t});if(n&2&&typeof t!="string")for(var i in t)e.d(r,i,function(e){return t[e]}.bind(null,i));return r}}();!function(){e.n=function(t){var n=t&&t.__esModule?function getDefault(){return t["default"]}:function getModuleExports(){return t};e.d(n,"a",n);return n}}()});